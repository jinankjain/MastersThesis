% Chapter Scion Lab Deployment

\chapter{SCIONLab Deployment} % Main chapter title
\label{scionlab} % For referencing the chapter elsewhere, use \ref{scionlab}

\section{SCIONLab Experimentation Environment}
SCIONLab  is an ongoing project that enables researchers to quickly and easily interface with the SCION network and perform experiments. The main idea of SCIONLab is that participants join the SCION network environment with their own computation resources and set up their own ASes, which get connected to the actual SCION network. The new ASes will actively participate in routing inside the SCION network. Consequently, SCIONLab enables realistic experimentation with the unique properties of SCION.

A researcher becomes a SCIONLab user by creating an account via the SCIONLab Coordination Service, creates ASes in her research institution, either on the dedicated hosts or inside virtual machines, and connects these ASes to SCIONLab ASes, which are a subset of SCION ASes with the capability to accept connections from SCIONLab users. The user can then start sending and receiving packets through the SCION network.

The operation of SCIONLab leverages the existing mechanisms and the framework developed for SCION's deployment, such as the Local Management Service, the SCIONLab Coordination Service, and Ansible. Moreover, SCIONLab also aims at hosting test versions of SCION, with new and experimental features like APNA, and also to enable SCIONLab users to connect to one another.

\section{Deploying APNA Management Service}
\subsection{Requirements}
\subsubsection{Virtual Private Network (VPN)}
Since APNA Management Service (Chapter \ref{apnams}) is a very crucial part of the infrastructure and every entity that wants to access its services should be able to reach it. In the usual SCIONLab AS scenario everything is behind a NAT which is problematic, thus requires setting up of VPN tunnel. 

As a matter of fact APNA Management Service won't be the first one to use a VPN tunnel. Border Routers also face the same problem since the current overlay network in SCION is UDP/IPv4 and thus getting an IPv4 address for every interface of the border is not possbile. Thus everything has to be behind a NAT. Border router uses an OpenVPN to establish VPN tunnel. So in order to deploy APNA Management Service we also took help from VPN tunnels, but instead of using OpenVPN, we have used Wireguard which is way faster than OpenVPN and implemented inside Linux kernel itself.

\subsection{Configuration}
\begin{itemize}
    \item \textbf{IP}: denotes an IPv4/IPv6 address on which service will start listening
    \item \textbf{Port}: denotes a UDP port on which service will start listening
    \item \textbf{SignAlgorithm}: denotes the signing algorithm which is used to sign the certificate generated by APNA Management Service. Currently it only supports \textit{Ed25519}
    \item \textbf{SignPubKey}: denotes the public key which is used by signing algorithm. Size of public key is usually 32 bytes.
    \item \textbf{SignPrivKey}: denotes the private key which is used by signing algorithm. Size of private key is usually 64 bytes.
    \item \textbf{HMACKey}: denotes the key which is used to generate 4-byte MAC for EphID authenticity. HMACKeys are usually 64 bytes long. HMAC internally uses \texttt{SHA256} to generate that MAC.
    \item \textbf{SiphashKey}: denotes the key which is used to generate Host ID from IPv4/IPv6 addresses using SipHash. Size of this key is usually 16 bytes.
    \item \textbf{AESKey}: denotes the key used by APNA Management Service to encrypt the host identifier. This key is 16 bytes long.
\end{itemize}

\subsubsection{Sample Configuration}
\inputminted[frame=lines, framesep=2mm, baselinestretch=1.2, fontsize=\footnotesize, breaklines]{json}{code_snippets/apnad.json}

In order to generate the above configuration \texttt{apnad\_config\_gen} which takes IP and Port number as an argument and output this configuration file.

\subsection{Hardware Requirements}
There is not a strict hardware requirement as its basically a simple Go UDP server. Anything with 1 GB RAM would work. I have tried deploying this application on a Raspberry-Pi 3B Model and it worked fine.

\section{Deployment efforts needed for different approach}

\subsection{APNA inside SCION}
This approach is deploy-able on the current SCIONLab infrastructure as we discussed in Chapter \ref{apna_overlay} as it only requires source and destination border router capable of understanding APNA protocol which is easily possible by deploying two new AS on the current infrastructure. But there are some small challenges which are worth mentioning.

\subsection{APNA Address Family}
In order to deploy this approach all the Border Router needs to understand this new address family.

\subsection{APNA Forwarding Service}
This approach is deploy-able on the current SCIONLab infrastructure as a matter of fact it is currently deployed on five different AS in different ISDs.